<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" />-->
    <link rel="stylesheet" href="style.css">
    <title>Password Generator</title>
</head>
<style>
    .card {
        display: flex;
        flex-direction: column;
        justify-content: center;
        border: 1px solid #000;
        width: 80%;
        height: 60%;
    }

    .con {
        display: flex;
        flex-direction: column;
        justify-content: left;
        border: 1px solid #000;
    }
</style>

<body>
    <h1> My prject</h1>
    <a href="{% url 'upload_file' %}">To upload SCV file</a>
    <div class="card">
        <div class="card-body">
            <div class="recipe">
                <a href="media\{{csv.doc}}">{{csv.doc}}</a>
            </div>
            <div class="total">
                <ul>
                    {% for l in lines %}
                    <li>{{l}}</li>
                    {% endfor %}
                </ul>
            </div>
            <div class="method">

            </div>
        </div>
    </div>
    <div class="con">
        {{title}}
        <ul id="con">
            {% for i in ing %}
            <li>{{i}}</li>
            {% endfor %}
        </ul>

    </div>
    {{method}}
    <script src="script.js"></script>
</body>
<script>
    const URL_DATA = ('/api_data_cost')
    getData(URL_DATA)
    const recipeEl = document.getElementById('con').children
    //console.log(recipeEl)
    var arrStr = []
    var recConatiner = []
    for (let i = 0; i < recipeEl.length; i++) {
        var LineText = recipeEl[i].innerHTML
        var t = LineText.split(' ')
        arrStr.push(t)
        recConatiner.push(LineText)

    }

    var ingr_cost = new Set()
    var totalCost = new Set()

    async function getData(url) {
        const res = await fetch(url)
        const data = await res.json()
        //console.log(data)
        arrStr.forEach((e, idx) => {
            data.forEach(d => {
                e.forEach(element => {
                    var new_d = d.Name.split(' ')
                    //console.log(e[0])
                    var newName = e[2] + ' ' + e[3]
                    var newPro = new_d[0] + ' ' + new_d[2]
                    //console.log(e[2] + ' ' + e[3])
                    if (newName.toLowerCase() == d.Name.toLowerCase()) {
                        //console.log(d.Unit * 1000)
                        ingr_cost.add(d)
                        ingr_cost.forEach(item => {
                            if (item.Name == 'Caster Sugar' && item.Unit != 25.000) {
                                ingr_cost.delete(item)
                            }
                        })

                        // need to get the right amount 
                        // create the math function
                        // calculate the cost per recipe
                    }

                })

            })



            //console.log(e, '-', idx)
            //console.log(recNew)


        })
        let counter = 0
        ingr_cost.forEach(ing => {
            //console.log(ing)
            arrStr.forEach((e, idx) => {
                if (idx < arrStr.length) {
                    //console.log(idx)
                    counter++
                    var c = ing.Unit * 1000
                    var a = ing.Price / c
                    var b = e[0] * a
                    totalCost.add(b)

                }


            })

        })
    }
    let temp = 0
    let total = 0
    totalCost.forEach(p => {
        totol = p + temp
        console.log(p)
    })


    console.log(totalCost)
    TotalCalc(ingr_cost, arrStr)
    async function TotalCalc(arr1, arr2) {

    }


    var recNew = new Set()
    recConatiner.forEach((line, idx) => {
        var newLines = line.split(/\s+/)
        //console.log(newLines, '-', idx)
        recNew.add(newLines, idx)
    })


    //console.log(recNew)
</script>

</html>